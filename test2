cat("\f")
# Load required packages --------------------------------------------------

library(shinytest) # One-time load
library(testthat) # One-time load

# Set the Inputs --------------------------------------------------

start_time <- Sys.time()
dates <- seq(as.Date("2018-11-27"), as.Date("2019-12-28"), by = 1)

#' Set the dates in the above code for which you need to test the application
#' For example Start date is "2019-11-27" and end date is "2019-12-28"

Tic_Dates <- expand.grid(ticker_data$sBasketTicker, dates)
Tic_Dates$Var1 <- as.character(Tic_Dates$Var1)
Tic_Dates_matrix <-
  as.matrix.data.frame(Tic_Dates) # original dataset
#Tic_Dates1 <- Tic_Dates_matrix
Tic_Dates1 <- Tic_Dates_matrix[c(1:3), ]

#' Set the combination of inputs in the above code for which you need to test the application. You can increase the number of 3 

#' Tic_Dates1 <- Tic_Dates_matrix[c(1:3), ]  
#'    Var1       Var2
#' 1 ANGLCR 2019-11-27
#' 2 ANGLRD 2019-11-27
#' 3 CBONCR 2019-11-27





# To check whethere the application is getting crashed for all combination of inputs --------------------------------------------------
new_value <- list()
app <- ShinyDriver$new(getwd())
results_log <- capture.output({
  for (i in 1:nrow(Tic_Dates1)) {
    tryCatch({
      new_value[[i]] <-
        app$setInputs(
          Tic = Tic_Dates1[i, 1],
          Date = Tic_Dates1[i, 2],
          Submit = "click",
          timeout_ = 6000
        )
      if (expect_that(new_value[[i]], throws_error()))
        stop("")
    }
    ,
    error = function(e) {
      cat("ERROR :", conditionMessage(e), "\n")
    })
  }
})
app$stop()


#results_log <- cat(paste0(results_log, collapse = "\n"))
store_results_log_in_dataframe <- as.data.frame(results_log)

Tic_Dates1 <- as.data.frame(Tic_Dates1)
final_output <-
  cbind(Tic_Dates1, store_results_log_in_dataframe) # final_output shows if the application got crashed or not


rm(results_log)
rm(store_results_log_in_dataframe)
rm(Tic_Dates1)
end_time <- Sys.time()

end_time - start_time 

# Clear Objects --------------------------------------------------
rm(app)
